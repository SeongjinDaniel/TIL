# VPC(Virtual Private Cloud)



:bell: 아마존 공식 설명

> Amazon Virtual Private Cloud(VPC)를 사용하면 AWS 클라우드에서 논리적으로 격리된 공간을 프로비저닝하여 고객이 정의하는 가상 네트워크에서 AWS 리소스를 시작할 수 있습니다. IP 주소 범위 선택, 서브넷 생성, 라우팅 테이블 및 네트워크 게이트웨이 구성등 가상 네트워킹 환경을 완벽하게 제어할 수 있습니다. VPC에서 IPv4와 IPv6를 모두 사용하여 리소스와 애플리케이션에 안전하고 쉽게 액세스할 수 있습니다.



즉, **논리적으로 공간을 격리** 하는데 우리가 사용하는 EC2, RDS 등이 이 격리된 공간 위에서 리소스를 생성하는 것입니다.

하나의 계정에서 생성한 리소스들만의 **격리된 네트워크**를 만들어주는 기능이 바로 VPC이고, 격리되어 있기 때문에 다른 사람들은 접근하고 보는 것이 불가능해집니다.

2019년부터 모든 사용자에게 VPC적용이 강제적으로 부여됐기 때문에, 대부분의 서비스는 VPC없이는 사용할 수가 없습니다.

![image](https://user-images.githubusercontent.com/55625864/107878248-9a149000-6f14-11eb-82b4-709d51481260.png)



#### 참조

- [AWS VPC란?](https://velog.io/@may_soouu/AWS-VPC%EB%9E%80)



---



## Network

Network는 Net(촘촘하게 연결되어 있는) + Work(일)의 합성어로 연결해서 서로가 가지고 있는 정보를 결합하여 생산적인 가치 만드는 일을 말합니다. 간략하게 말해서 '네트워킹을 한다 = 서로 통신(Communication)을 한다'고 할 수 있습니다.

통신을 위해 지켜야하는 약속들을 프로토콜(Protocol)이라고 합니다.



## VPN(Virtual Private Network)



VPN은 Virtual Private Network의 약자로 큰 규모의 조직이 여러 곳에 분산되어 있는 컴퓨터들을 연결하는 보안성이 높은 사설 네트워크(Private Network)를 만들거나, 인터넷을 활용하여 우너격지 간에 네트워크를 서로 연결하고 암호화 기술을 적용하여 보다 안정적이며, 보안성 높은 통신 서비스를 제공하는 서비스를 말합니다.



## VPC(Virtual Private Cloud)

Amazon VPC는 Virtual Private Cloud의 약자로 AWS 클라우드에서 논리적으로 격리된 네트워크 공간을 할당하여 가상 네트워크에서 AWS 리소스를 이용할 수 있는 서비스를 제공합니다.

Amazon VPC 자체 IP 주소 범위, 서브넷(subnet) 생성, 라우팅 테이블(Routing Table) 및 네트워크 게이트웨이 구성 선택 등 가상 네트워킹 환경을 완벽하게 제어할 수 있으며, VPC에서 IPv4와 IPv6를 모두 사용하여 리소스와 애플리케이션에 안전하고 쉽게 액세스할 수 있습니다.



# Amazon 공식 홈페이지 Summary



# Amazon VPC란 무엇인가?



Amazon Virtual Private Cloud(Amazon VPC)를 이용하면 사용자가 정의한 가상 네트워크로 AWS 리소스를 시작할 수 있습니다. 이 가상 네트워크는 AWS의 확장 가능한 인프라를 사용한다는 이점과 함께 고객의 자체 데이터 센터에서 운영하는 기존 네트워크와 매우 유사합니다.



## Amazon VPC 개념

Amazon VPC는 Amazon EC2의 네트워킹 계층입니다. Amazon EC2를 처음 사용한다면 *Linux 인스턴스용 Amazon EC2 사용 설명서*의 [Amazon EC2란 무엇입니까?](https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/concepts.html)를 읽어 대략적인 내용을 확인하십시오.



다음은 VPC의 핵심 개념입니다.

### :grey_question: 밑에 부분 제대로 확인해서 알아 놓기!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!

- **Virtual Private Cloud(VPC)** — 사용자의 AWS 계정 전용 가상 네트워크입니다.
- **서브넷** — VPC의 IP 주소 범위입니다.
- **라우팅 테이블** — 네트워크 트래픽을 전달할 위치를 결정하는데 사용하는 라우팅이라는 이름의 규칙 집합입니다.
- **인터넷 게이트웨이** — VPC의 리소스와 인터넷 간의 통신을 활성화하기 위해 VPC에 연결하는 게이트웨이입니다.
- **VPC 엔드포인트** — 인터넷 게이트웨이, NAT 디바이스, VPN 연결 또는 AWS Direct Connect 연결 없이도 PrivateLink로 구동하는 지원되는 AWS 서비스 및 VPC 엔드포인트 서비스에 비공개로 연결할 수 있게 합니다. VPC의 인스턴스는 서비스의 리소스와 통신하는 데 퍼블릭 IP 주소를 필요로 하지 않습니다. VPC와 기타 서비스 간의 트래픽은 Amazon 네트워크를 벗어나지 않습니다. 자세한 내용은 [VPC 엔드포인트 및 VPC 엔드포인트 서비스(AWS PrivateLink)](https://docs.aws.amazon.com/ko_kr/vpc/latest/userguide/endpoint-services-overview.html)를 참조하십시오.



## Amazon VPC 요금

VPC 사용에 따르는 추가 요금은 없습니다. VPC 구성 요소인 Site-to-Site VPN 연결, PrivateLink, 트래픽 미러링 및 NAT 게이트웨이에 대한 요금이 부과됩니다. 자세한 내용은 [Amazon VPC 요금](http://aws.amazon.com/vpc/pricing/)을 참조하십시오.



# Amazon VPC 작동 방식

Amazon Virtual Private Cloud(Amazon VPC)를 이용하면 사용자가 정의한 가상 네트워크로 AWS 리소스를 시작할 수 있습니다. 이 가상 네트워크는 AWS의 확장 가능한 인프라를 사용한다는 이점과 함께 고객의 자체 데이터 센터에서 운영하는 기존 네트워크와 매우 유사합니다.

Amazon VPC는 Amazon EC2의 네트워킹 계층입니다.



## VPC 및 서브넷

*Virtual Private Cloud*(VPC)는 사용자의 AWS 계정 전용 가상 네트워크입니다. VPC는 AWS 클라우드에서 다른 가상 네트워크와 논리적으로 분리되어 있습니다. Amazon EC2 인스턴스 같은 AWS 리소스를 VPC에서 실행할 수 있습니다. **IP 주소 범위와 VPC 범위를 설정하고 서브넷을 추가하고 보안 그룹을 연결한 다음 라우팅 테이블을 구성합니다.**

*서브넷*은 VPC의 IP 주소 범위입니다. 지정된 서브넷으로 AWS 리소스를 시작할 수 있습니다. **인터넷에 연결되어야 하는 리소스에는 퍼블릭 서브넷을 사용**하고, **인터넷에 연결되지 않는 리소스에는 프라이빗 서브넷을 사용**하십시오.

각 서브넷의 AWS리소스를 보호하기 위해 보안 그룹 및 네트워크 액세스 제어 목록(ACL)을 비롯한 여러 보안 계층을 사용할 수 있습니다.

IPv6 CIDR 블록을 VPC에 연결하고 IPv6 주소를 VPC의 인스턴스에 할당할 수도 있습니다.



## VPC 및 서브넷 기본 사항

Virtual Private Cloud(VPC)는 사용자의 AWS 계정 전용 가상 네트워크입니다. VPC는 AWS 클라우드에서 다른 가상 네트워크와 논리적으로 분리되어 있습니다. Amazon EC2 인스턴스 같은 AWS 리소스를 VPC에서 실행할 수 있습니다.

VPC를 만들 때 VPC의 IPv4 주소의 범위를 CIDR(Classless Inter-Domain Routing) 블록 형태로 지정해야 합니다(예: `10.0.0.0/16`). 이것은 VPC의 기본 CIDR 블록입니다. CIDR 표기법에 대한 자세한 정보는 [RFC 4632](https://tools.ietf.org/html/rfc4632)을 참조하십시오.

![image-20210216154330022](C:\Users\oliver\AppData\Roaming\Typora\typora-user-images\image-20210216154330022.png)

기본 라우팅 테이블에는 다음과 같은 경로가 있습니다.

| 대상 주소   | 대상 |
| ----------- | ---- |
| 10.0.0.0/16 | 로컬 |

VPC는 리전의 모든 가용 영역에 적용됩니다. VPC를 만든 후 각 가용 영역에 하나 이상의 서브넷을 추가할 수 있습니다. 필요에 따라 컴퓨팅, 스토리지, 데이터베이스 및 기타 선택 서비스를 최종 사용자에게 더 가깝게 배치하는 AWS 인프라 배포인 로컬 영역에 서브넷을 추가할 수 있습니다. 서브넷을 만들 때 해당 서브넷에 대한 CIDR 블록을 지정합니다. 이는 VPC CIDR 블록의 서브넷입니다. 각 서브넷은 단일 가용 영역 내에서만 존재해야 하며, 여러 영역으로 확장할 수 없습니다. 각 가용 영역은 다른 가용 영역에서 발생한 장애를 격리시킬 수 있도록 서로 분리된 공간입니다. 별도의 가용 영역에서 인스턴스를 시작함으로써 단일 위치에서 장애가 발생할 경우 애플리케이션을 보호할 수 있습니다. AWS는 각 서브넷에 고유 ID를 할당합니다.

IPv6 CIDR 블록을 VPC와 서브넷 각각 할당할 수도 있습니다.

다음 그림은 여러 가용 영역의 서브넷으로 구성된 VPC를 보여 줍니다. 1A, 2A 및 3A는 VPC에 있는 인스턴스입니다. IPv6 CIDR 블록 하나는 VPC와 연결되어 있고, IPv6 CIDR 블록 하나는 서브넷 1과 연결되어 있습니다. 인터넷 게이트웨이를 통해 인터넷에서 통신할 수 있으며, 가상 프라이빗 네트워크(VPN) 연결을 통해 기업 네트워크와 통신할 수 있습니다.

![image](https://user-images.githubusercontent.com/76925694/108028383-1b803580-706f-11eb-9ff5-93557943cb00.png)

**서브넷 트래픽이 인터넷 게이트웨이로 라우팅되는 경우 해당 서브넷을 *퍼블릭 서브넷*이라고 합니다.**

이 그림에서는 서브넷 1이 퍼블릭 서브넷입니다. 퍼블릭 서브넷의 인스턴스가 IPv4를 통해 인터넷과 통신할 수 있게 하려면 인스턴스에 퍼블릭 IPv4 주소 또는 탄력적 IP 주소(IPv4)가 있어야 합니다. 퍼블릭 IPv4 주소에 대한 자세한 내용은 [퍼블릭 IPv4 주소](https://docs.aws.amazon.com/ko_kr/vpc/latest/userguide/vpc-ip-addressing.html#vpc-public-ipv4-addresses) 단원을 참조하십시오. 퍼블릭 서브넷의 인스턴스가 IPv6를 통해 인터넷과 통신할 수 있으려면 인스턴스에 퍼블릭 IPv6 주소가 있어야 합니다.

**인터넷 게이트웨이로 라우팅되지 않는 서브넷을 *프라이빗 서브넷*이라고 합니다.** 이 그림에서는 서브넷 2가 프라이빗 서브넷입니다.

**서브넷이 인터넷 게이트웨이에 이르는 경로를 갖고 있지 않지만 그 트래픽이 Site-to-Site VPN 연결을 위한 가상 프라이빗 게이트웨이로 라우팅되는 경우, 이 서브넷을 *VPN 전용 서브넷*이라고 합니다.** 이 그림에서는 서브넷 3이 VPN 전용 서브넷입니다. 현재 Site-to-Site VPN 연결을 통한 IPv6 트래픽은 지원하지 않습니다.

자세한 내용은 *AWS Site-to-Site VPN 사용 설명서*의 [VPC에 대한 예](https://docs.aws.amazon.com/ko_kr/vpc/latest/userguide/VPC_Scenarios.html), [인터넷 게이트웨이](https://docs.aws.amazon.com/ko_kr/vpc/latest/userguide/VPC_Internet_Gateway.html) 및 [AWS Site-to-Site VPN이란 무엇입니까?](https://docs.aws.amazon.com/vpn/latest/s2svpn/VPC_VPN.html)를 참조하십시오.



## 기본 VPC와 기본이 아닌 VPC

2013년 12월 4일 이후에 생성한 계정일 경우 각 가용 영역에 *기본 서브넷*이 있는 *기본 VPC*가 제공됩니다. 기본 VPC는 EC2-VPC가 제공하는 고급 기능의 장점을 가지고 있으며 바로 사용할 수 있게 설정되어 있습니다. 기본 VPC가 있고 서브넷을 지정하지 않을 경우 인스턴스를 시작할 때 기본 VPC로 인스턴스가 시작됩니다. Amazon VPC에 대한 지식이 전혀 없어도 기본 VPC로 인스턴스를 시작할 수 있습니다.

자체 VPC를 생성하고 필요에 따라 구성할 수도 있습니다. 이를 *기본이 아닌 VPC*라고 합니다. 기본이 아닌 VPC에 만든 서브넷과 기본 VPC에 만든 추가 서브넷은 *기본이 아닌 서브넷*이라고 합니다.



## 라우팅 테이블

*라우팅 테이블*에는 VPC의 네트워크 트래픽을 전달할 위치를 결정하는 데 사용되는 라우팅이라는 규칙 집합이 포함되어 있습니다. 서브넷을 특정 라우팅 테이블과 명시적으로 연결할 수 있습니다. 그렇지 않으면 서브넷이 기본 라우팅 테이블과 암시적으로 연결됩니다.

라우팅 테이블의 각 라우팅은 트래픽을 전달할 IP 주소 범위(대상 주소)와 트래픽을 전송할 게이트웨이, 네트워크 인터페이스 또는 연결(대상)을 지정합니다.

## 라우팅 테이블 개념

다음은 라우팅 테이블의 주요 개념입니다.

- **기본 라우팅 테이블** — VPC와 함께 자동으로 제공되는 라우팅 테이블입니다. 다른 라우팅 테이블과 명시적으로 연결되지 않은 모든 서브넷의 라우팅을 제어합니다.
- **사용자 지정 라우팅 테이블** — VPC에 대해 생성하는 라우팅 테이블입니다.
- **엣지 연결** — 인바운드 VPC 트래픽을 어플라이언스로 라우팅하는 데 사용하는 라우팅 테이블입니다. 라우팅 테이블을 인터넷 게이트웨이 또는 가상 프라이빗 게이트웨이와 연결하고 어플라이언스의 네트워크 인터페이스를 VPC 트래픽의 대상으로 지정합니다.
- **라우팅 테이블 연결** — 라우팅 테이블과 서브넷, 인터넷 게이트웨이 또는 가상 프라이빗 게이트웨이 간의 연결입니다.
- **서브넷 라우팅 테이블** — 서브넷과 연결된 라우팅 테이블입니다.
- **게이트웨이 라우팅 테이블** — 인터넷 게이트웨이 또는 가상 프라이빗 게이트웨이와 연결된 라우팅 테이블입니다.
- **로컬 게이트웨이 라우팅 테이블** — Outposts 로컬 게이트웨이와 연결된 라우팅 테이블입니다. 로컬 게이트웨이에 대한 자세한 내용은 *AWS Outposts 사용 설명서*의 [로컬 게이트웨이](https://docs.aws.amazon.com/outposts/latest/userguide/outposts-local-gateways.html)를 참조하십시오.
- **대상** — 트래픽을 이동할 대상 IP 주소(대상 CIDR)의 범위입니다. 예를 들어, `172.16.0.0/12` CIDR이 있는 외부 회사 네트워크입니다.
- **전파** — 라우팅 전파를 사용하면 가상 프라이빗 게이트웨이가 라우팅 테이블에 라우팅을 자동으로 전파할 수 있습니다. 즉, 라우팅 테이블에 VPN 라우팅을 수동으로 입력할 필요가 없습니다. VPN 라우팅 옵션에 대한 자세한 내용은 *Site-to-Site VPN 사용 설명서*의 [Site-to-Site VPN 라우팅 옵션](https://docs.aws.amazon.com/vpn/latest/s2svpn/VPNRoutingTypes.html)을 참조하십시오.
- **대상** — 대상 트래픽을 전송할 때 사용할 게이트웨이, 네트워크 인터페이스 또는 연결입니다(예: 인터넷 게이트웨이).
- **로컬 라우팅** — VPC 내 통신을 위한 기본 라우팅입니다.

### 라우팅

테이블의 각 라우팅은 목적지 및 대상을 지정합니다. 예를 들어 서브넷이 인터넷 게이트웨이를 통해 인터넷에 액세스할 수 있도록 하려면 서브넷 라우팅 테이블에 다음 라우팅을 추가합니다.

| 대상      | 대상                  |
| --------- | --------------------- |
| 0.0.0.0/0 | igw-12345678901234567 |

라우팅의 대상은 모든 IPv4 주소를 나타내는 `0.0.0.0/0`입니다. 대상은 VPC에 연결된 인터넷 게이트웨이입니다.

IPv4 및 IPv6 CIDR 블록은 별도로 취급됩니다. 예를 들어 대상 CIDR이 `0.0.0.0/0`인 라우팅에는 모든 IPv6 주소가 자동으로 포함되지 않습니다. 모든 IPv6 주소에 대해 대상 CIDR이 `::/0`인 라우팅을 생성해야 합니다.



## 인터넷 액세스

VPC에서 시작한 인스턴스가 VPC 외부의 리소스를 어떻게 액세스할지를 제어할 수 있습니다.

기본 VPC에는 인터넷 게이트웨이가 포함되며, 각각의 기본 서브넷은 퍼블릭 서브넷입니다. 기본 서브넷에서 시작한 각 인스턴스에는 프라이빗 IPv4 주소와 퍼블릭 IPv4 주소가 있습니다. 이러한 인스턴스는 인터넷 게이트웨이를 통해 인터넷과 통신할 수 있습니다. 인터넷 게이트웨이를 통해 인스턴스는 Amazon EC2 네트워크 엣지를 통해 인터넷에 연결할 수 있습니다.

![image](https://user-images.githubusercontent.com/76925694/108037641-39549700-707d-11eb-93a3-bfc8aa229c70.png)

기본적으로 기본이 아닌 서브넷에서 시작한 각 인스턴스에는 프라이빗 IPv4 주소가 있으며, 시작 시 특별히 지정하거나 서브넷의 퍼블릭 IP 주소 속성을 수정하지 않는 한 퍼블릭 IPv4 주소는 없습니다. 이러한 인스턴스는 서로 통신할 수는 있지만 인터넷에 액세스할 수는 없습니다.

![image](https://user-images.githubusercontent.com/76925694/108037722-56896580-707d-11eb-82ed-033ca723e7e2.png)

기본이 아닌 서브넷에서 시작한 인스턴스에 대해 해당 VPC에 인터넷 게이트웨이를 추가하고(해당 VPC가 기본 VPC가 아닐 경우) 인스턴스에 탄력적 IP 주소를 연결하여 인터넷 액세스를 가능하게 할 수 있습니다.

![ 					인터넷 게이트웨이 사용 				](https://docs.aws.amazon.com/ko_kr/vpc/latest/userguide/images/internet-gateway-diagram.png)

또는 VPC의 인스턴스가 인터넷으로 아웃바운드 연결을 시작할 수 있도록 하되 인터넷으로부터의 원치 않는 인바운드 연결은 차단하려면 IPv4 트래픽용 네트워크 주소 변환(NAT) 디바이스를 사용하면 됩니다. NAT는 여러 개의 프라이빗 IPv4 주소를 하나의 퍼블릭 IPv4 주소에 매핑합니다. NAT 디바이스는 탄력적 IP 주소를 가지며, 인터넷 게이트웨이를 통해 인터넷에 연결됩니다. 프라이빗 서브넷의 인스턴스를 NAT 디바이스를 통해 인터넷에 연결할 수 있으며, 이렇게 하면 인스턴스의 트래픽이 인터넷 게이트웨이로 라우팅되고, 모든 응답은 인스턴스로 라우팅됩니다.

## 회사 또는 홈 네트워크에 액세스

원한다면 IPsec AWS Site-to-Site VPN 연결을 사용하여 VPC를 회사의 데이터 센터에 연결하여 회사 데이터 센터를 AWS 클라우드로 확장할 수 있습니다.

Site-to-Site VPN 연결은 AWS 측의 가상 프라이빗 게이트웨이 또는 전송 게이트웨이와 데이터 센터의 고객 게이트웨이 디바이스 간 두 개의 VPN 터널로 구성됩니다. 고객 게이트웨이는 Site-to-Site VPN 연결에서 고객 측이 구성하는 물리적 디바이스 또는 소프트웨어 애플리케이션입니다.

![image](https://user-images.githubusercontent.com/76925694/108038578-5ccc1180-707e-11eb-9ae0-c10eebe6dd75.png)

## AWS PrivateLink를 통한 서비스 액세스

AWS PrivateLink는 지원되는 AWS 서비스, 기타 AWS 계정에서 호스팅된 서비스(VPC 엔드포인트 서비스) 및 지원 AWS Marketplace 파트너 서비스에 VPC를 비공개로 연결할 수 있도록 하는 가용성과 확장성이 높은 기술입니다. 인터넷 게이트웨이, NAT 디바이스, 퍼블릭 IP 주소, AWS Direct Connect 연결 또는 AWS Site-to-Site VPN 연결이 없어도 서비스와 통신할 수 있습니다. VPC와 서비스 간의 트래픽은 Amazon 네트워크를 벗어나지 않습니다.

AWS PrivateLink를 사용하려면 VPC에 서비스에 대한 인터페이스 VPC 엔드포인트를 생성해야 합니다. 서비스로 전달되는 트래픽에 대한 진입점 역할을 하는 프라이빗 IP 주소를 포함하여 서브넷에 탄력적 네트워크 인터페이스를 생성합니다.

![image](https://user-images.githubusercontent.com/76925694/108039218-2ba01100-707f-11eb-9fd9-711df8cb43fb.png)

자체 AWS PrivateLink 구동 서비스(엔드포인트 서비스)를 생성하고 다른 AWS 고객이 서비스에 액세스하도록 허용할 수 있습니다.

## VPC 및 네트워크 연결

두 VPC 간에 *VPC 피어링 연결*을 생성하여 비공개적으로 두 VPC 간에 트래픽을 라우팅할 수 있습니다. 동일한 네트워크에 속하는 경우와 같이 VPC의 인스턴스가 서로 통신할 수 있습니다.

또한 *전송 게이트웨이*를 생성하고 사용해 VPC와 온프레미스 네트워크를 상호 연결할 수 있습니다. 전송 게이트웨이는 VPC, VPN 연결, AWS Direct Connect 게이트웨이, 전송 게이트웨이 피어링 연결 등 연결 간에 이동하는 트래픽에 대해 리전 가상 라우터 역할을 합니다.





#### 참조

- [[AWS] 가장쉽게 VPC 개념잡기](https://medium.com/harrythegreat/aws-%EA%B0%80%EC%9E%A5%EC%89%BD%EA%B2%8C-vpc-%EA%B0%9C%EB%85%90%EC%9E%A1%EA%B8%B0-71eef95a7098)

- [Amazon VPC란 무엇인가?](https://docs.aws.amazon.com/ko_kr/vpc/latest/userguide/what-is-amazon-vpc.html)

- [VPC 엔드포인트](https://docs.aws.amazon.com/ko_kr/vpc/latest/userguide/vpc-endpoints.html)