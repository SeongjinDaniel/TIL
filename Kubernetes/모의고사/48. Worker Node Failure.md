# 48. Worker Node Failure



1. Fix the broken cluster

   **Hint**

   - Step1. Check the status of services on the nodes.
   - Step2. Check the service logs using `journalctl -u kubelet`.
   - Step3. If it's stopped then start the stopped services.
     Alternatively, run the command:
     `ssh node01 "service kubelet start"`

   **Solution**

   - Step1: Check the status of the nodes:

     ```sh
     root@controlplane:~# kubectl get nodes
     NAME           STATUS     ROLES                  AGE     VERSION
     controlplane   Ready      control-plane,master   6m38s   v1.20.0
     node01         NotReady   <none>                 4m59s   v1.20.0
     root@controlplane:~# 
     ```

     Step 2: SSH to node01 and check the status of container runtime (docker, in this case) and the `kubelet` service.

     ```sh
     root@node01:~# systemctl status kubelet
     ● kubelet.service - kubelet: The Kubernetes Node Agent
        Loaded: loaded (/lib/systemd/system/kubelet.service; enabled; vendor preset: enabled)
       Drop-In: /etc/systemd/system/kubelet.service.d
                └─10-kubeadm.conf
        Active: inactive (dead) since Sun 2021-07-25 07:46:58 UTC; 5min ago
          Docs: https://kubernetes.io/docs/home/
       Process: 1917 ExecStart=/usr/bin/kubelet $KUBELET_KUBECONFIG_ARGS $KUBELET_CONFIG_ARGS $KUBELET_KUBEADM_ARGS $KUBELET_EXTRA_ARGS (code=exited,
      Main PID: 1917 (code=exited, status=0/SUCCESS)
     ```

     Since the `kubelet` is not running, attempt to start it by running:

     ```sh
     root@node01:~# systemctl start kubelet
     root@node01:~# systemctl status kubelet
     ● kubelet.service - kubelet: The Kubernetes Node Agent
        Loaded: loaded (/lib/systemd/system/kubelet.service; enabled; vendor preset: enabled)
       Drop-In: /etc/systemd/system/kubelet.service.d
                └─10-kubeadm.conf
        Active: active (running) since Sun 2021-07-25 07:53:35 UTC; 2s ago
          Docs: https://kubernetes.io/docs/home/
     ```

     node01 should go back to ready state now.