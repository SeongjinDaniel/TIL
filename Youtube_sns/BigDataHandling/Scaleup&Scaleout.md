우리가 개발한 서비스에 사용자 유입이 적을 때는 괜찮겠지만 사용자 유입이 급격히 늘어난다면 가용 자원 서버에 부하가 걸려 병목현상을 일으킬수 있습니다. 예를들면 검색엔진 사이트의 경우에 손흥민이 골을 넣었다라던지 핫한 연애인에 관련된 이슈가 터지게 되면 사용자 유입이 급격히 늘어날 것입니다.

만약 대규모 트랙픽으로 인해 웹서버에 병목현상이 발생한다면 웹서버는 정보를 요청만 하고 어떠한 것도 저장하지 않고 있기 때문에 단순히 장비만 추가해주면 해결이 될 것입니다. 서버에 데이터를 저장 하지 않는 것을 Stateless하다고 표현합니다. 반대로 웹서버가 Stateful하다면 모든 정보를 저장하고 있을 것이고 모든 데이터가 날라가게 된다면 이 데이터를 복구할 방법이 없을 것입니다. 하지만 Stateless하다면 클라이언트나 DB 서버에 해당 데이터가 저장되어 있어서 복구할 웹 서버에 데이터를 복구할 수 있을 것입니다.

**정말로 문제가 되는것은 DB 서버에 병목현상이 생기면 어떻게 해결해야 할까**라는 것입니다.

서버의 성능을 향상시켜서 또는 서버의 대수를 늘려서 해결 해야합니다. 이제부터 트랙픽으로 인해 DB 병목현상에대비할 수 있는 확장성(Scalability)에 대해 **Scale up**과 **Scale out**에 대해서 알아보도록 하겠습니다.



# Scale up & Scale out



#### Scale up

Scale up은 수직적 확장으로써 성능을 올려 서버를 관리하는 것을 말합니다. RAM, CPU, DISK 성능을 교체하거나 추가하여 서버의 성능을 올리는 것입니다.  하지만 Scale up은 서버의 크기에 따라  서버에 추가할 수 있는 장치들의 수가 제한되어 있습니다. 더이상 추가 할 수 있는 소켓이 없으면 더 큰 서버로 변경하는데 모든 데이터를 Migration해야 하기 때문에 서버를 정지해서 작업해야하는 위험성이 있습니다. 또한, 속도나 성능을 높이기 위해서 추가 장치들을 계속 추가한다해도 비용대비 큰 성능을 기대할 수 없습니다. 서버의 확장성을 고려할 때 Scale up만 사용한다면 SPOF(단일 고장점)으로 인해 서버의 데이터를 모두 잃어버릴 수 있는 위험성이 있습니다. 마지막으로 Scale up은 가용성을 고려할 때 사용하는것이 적합합니다.

#### Scale out

Scale out은 수평적 확장으로써 여러대의 서버를 확장하여 관리하는 것을 말합니다. 지속적인 확장을 할 수 있지만 서버 대수가 확장됨에 따라 유지보수 및 관리 하는 비용이 늘어나게 되고, 많은 서버를 유지하기 위해 복잡한 설계를 할 수 있는 능력이 필요합니다. Scale out은 복잡하지 않고 단순한 데이터를 관리하는데 유용합니다. 예를들면 데이터베이스에 성능을 높이기 위해 사용하는 것 보다는 단순하게 대규모의 트래픽이 들어올 때 Session을 관리하는 것에 더 적합합니다. 이로써 데이터베이스의 성능을 높이기 위해 사용하기 보다는 대용량 트래픽이 발생할 수 있는 SNS나 검색엔진등에서 사용을 필요로 할것입니다.

또한, 여러 서버를 확장해서 사용할 수 있으니 데이터를 잃어버리지 않기 위해서 사용하는 이중화에 대해서도 생각해 볼 수 있을 것같습니다. 한대의 서버에 병목 현상(bottleneck)이 생겨 서버가 터진다면  이중화로 인해서 서버를 Failover(복구) 할 수 있습니다. 다른 서버에 데이터를 백업해 저장한다면 가용성 측면에서도 좋을 것입니다.



#### Scale up vs Scale out

|                     Scale up                      |                Scale out                 |
| :-----------------------------------------------: | :--------------------------------------: |
|                    비용이 비쌈                    |        Scale up보다 비용이 저렴함        |
| 비용 대비 서버 성능 측면에서 비교적 성능이 안나옴 | 비용처리 만큼 서버의 용량을 늘릴 수 있음 |
|                   관리가 용이함                   |      서버 확장에 따라 관리가 복잡함      |
|                 설계 비교적 쉬움                  |      서버 확장에 따라 설계가 복잡함      |
|             정합성을 요구할 때 사용됨             |        가용성을 요구할 때 사용됨         |









#### 참고

- Memcached와 Redis - 강대명 지음 [한빛미디어]
- [확장성 있는 웹 아키텍처와 분산 시스템](https://d2.naver.com/helloworld/206816)
- 